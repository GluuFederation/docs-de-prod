
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documenation for the Gluu Server Cluster">
      
      
      
      
        <link rel="shortcut icon" href="../..//img/gluu_favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.3">
    
    
      
        <title>Cluster Management - Gluu Cluster Docs</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-f3ab63f78a.css">
      
      
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
	 <div class="md-flex__cell md-flex__cell--shrink">
	    <a href="https://gluu.org/docs/" title="Gluu Cluster Docs" class=" md-logo  md-header-nav__button">
          
            <img src="../../gluu.jpg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Admin Guide
                </span>
              
            
            Cluster Management
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
              


  


  <a href="https://github.com/GluuFederation/docs-de-prod/tree/3.0.0/3.0.0" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

            
          </div>
      </div>
    </div>
   </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">

  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../../gluu.jpg">
      
    </i>
    Gluu Cluster Docs
	<label for="Versions">Ver:
	  <select id="versions" onchange="window.location.href=this.value;" style="
		position: inherit;
		display: inline;
		min-width: 25%;
		/* width: 120%; */
		height: 22px;
		padding: 5px 15px 5px 5px;
		color: black;
		border: none;
		background: transparent;
		outline: none;
		-webkit-appearance: none;
		z-index: 99;
		cursor: pointer;
		font-size: 10px;
		margin-bottom: 10px;
		border: 1px solid black;
		overflow: auto
	">
	  <option value="/docs/de/alpha">Alpha Release</option>
	  <!-- <option value="/docs/2.4.4">2.4.4</option> -->
		</select> 
	</label>
  </label>
    
    <div class="md-nav__source">
      


  


  <a href="https://github.com/GluuFederation/docs-de-prod/tree/3.0.0/3.0.0" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href="../.." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Admin Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2">
        Admin Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../overview/" title="Overview" class="md-nav__link">
        Overview
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../installation/" title="Installation" class="md-nav__link">
        Installation
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../getting-started/" title="Getting Started" class="md-nav__link">
        Getting Started
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Cluster Management
      </label>
    
    <a href="./" title="Cluster Management" class="md-nav__link md-nav__link--active">
      Cluster Management
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-cluster" title="Creating Cluster" class="md-nav__link">
    Creating Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-provider" title="Creating Provider" class="md-nav__link">
    Creating Provider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-nodes-and-containers" title="Creating Nodes and Containers" class="md-nav__link">
    Creating Nodes and Containers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-discovery-node" title="Creating Discovery Node" class="md-nav__link">
    Creating Discovery Node
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-node" title="Creating The Node" class="md-nav__link">
    Creating The Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-master-node-and-containers" title="Creating Master Node and Containers" class="md-nav__link">
    Creating Master Node and Containers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-node_1" title="Creating The Node" class="md-nav__link">
    Creating The Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-certificate-and-key" title="SSL Certificate and Key" class="md-nav__link">
    SSL Certificate and Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-ldap-schema" title="Custom LDAP Schema" class="md-nav__link">
    Custom LDAP Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-oxauth-files" title="Custom oxAuth Files" class="md-nav__link">
    Custom oxAuth Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-oxtrust-files" title="Custom oxTrust Files" class="md-nav__link">
    Custom oxTrust Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-containers" title="Creating Containers" class="md-nav__link">
    Creating Containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-oxtrust-web-interface" title="Accessing oxTrust Web Interface" class="md-nav__link">
    Accessing oxTrust Web Interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-worker-node-and-containers" title="Creating Worker Node and Containers" class="md-nav__link">
    Creating Worker Node and Containers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registering-license-key" title="Registering License Key" class="md-nav__link">
    Registering License Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-node_2" title="Creating The Node" class="md-nav__link">
    Creating The Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-containers_1" title="Creating Containers" class="md-nav__link">
    Creating Containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldap-replication" title="LDAP Replication" class="md-nav__link">
    LDAP Replication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../components/" title="Components" class="md-nav__link">
        Components
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../webui/" title="Web Interface" class="md-nav__link">
        Web Interface
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../troubleshooting/" title="Troubleshooting" class="md-nav__link">
        Troubleshooting
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../recovery/" title="Recovery" class="md-nav__link">
        Recovery
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../migration/" title="Migration" class="md-nav__link">
        Migration
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../known-issues/" title="Known Issues" class="md-nav__link">
        Known Issues
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API Section
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        API Section
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/api/cluster/" title="Cluster" class="md-nav__link">
        Cluster
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/api/provider/" title="Provider" class="md-nav__link">
        Provider
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/api/node/" title="Node" class="md-nav__link">
        Node
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/api/container/" title="Container" class="md-nav__link">
        Container
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/api/container_log/" title="Container Log" class="md-nav__link">
        Container Log
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/api/license_key/" title="License Key" class="md-nav__link">
        License Key
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-cluster" title="Creating Cluster" class="md-nav__link">
    Creating Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-provider" title="Creating Provider" class="md-nav__link">
    Creating Provider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-nodes-and-containers" title="Creating Nodes and Containers" class="md-nav__link">
    Creating Nodes and Containers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-discovery-node" title="Creating Discovery Node" class="md-nav__link">
    Creating Discovery Node
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-node" title="Creating The Node" class="md-nav__link">
    Creating The Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-master-node-and-containers" title="Creating Master Node and Containers" class="md-nav__link">
    Creating Master Node and Containers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-node_1" title="Creating The Node" class="md-nav__link">
    Creating The Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-certificate-and-key" title="SSL Certificate and Key" class="md-nav__link">
    SSL Certificate and Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-ldap-schema" title="Custom LDAP Schema" class="md-nav__link">
    Custom LDAP Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-oxauth-files" title="Custom oxAuth Files" class="md-nav__link">
    Custom oxAuth Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-oxtrust-files" title="Custom oxTrust Files" class="md-nav__link">
    Custom oxTrust Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-containers" title="Creating Containers" class="md-nav__link">
    Creating Containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-oxtrust-web-interface" title="Accessing oxTrust Web Interface" class="md-nav__link">
    Accessing oxTrust Web Interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-worker-node-and-containers" title="Creating Worker Node and Containers" class="md-nav__link">
    Creating Worker Node and Containers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registering-license-key" title="Registering License Key" class="md-nav__link">
    Registering License Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-node_2" title="Creating The Node" class="md-nav__link">
    Creating The Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-containers_1" title="Creating Containers" class="md-nav__link">
    Creating Containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldap-replication" title="LDAP Replication" class="md-nav__link">
    LDAP Replication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/GluuFederation/docs-de-prod/tree/3.0.0/3.0.0/source/admin-guide\cluster-management\index.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                <div class="toc">
<ul>
<li><a href="#cluster-management">Cluster Management</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#creating-cluster">Creating Cluster</a></li>
<li><a href="#creating-provider">Creating Provider</a></li>
<li><a href="#creating-nodes-and-containers">Creating Nodes and Containers</a><ul>
<li><a href="#creating-discovery-node">Creating Discovery Node</a><ul>
<li><a href="#creating-the-node">Creating The Node</a></li>
</ul>
</li>
<li><a href="#creating-master-node-and-containers">Creating Master Node and Containers</a><ul>
<li><a href="#creating-the-node_1">Creating The Node</a></li>
<li><a href="#ssl-certificate-and-key">SSL Certificate and Key</a></li>
<li><a href="#custom-ldap-schema">Custom LDAP Schema</a></li>
<li><a href="#custom-oxauth-files">Custom oxAuth Files</a></li>
<li><a href="#custom-oxtrust-files">Custom oxTrust Files</a></li>
<li><a href="#creating-containers">Creating Containers</a></li>
<li><a href="#accessing-oxtrust-web-interface">Accessing oxTrust Web Interface</a></li>
</ul>
</li>
<li><a href="#creating-worker-node-and-containers">Creating Worker Node and Containers</a><ul>
<li><a href="#registering-license-key">Registering License Key</a></li>
<li><a href="#creating-the-node_2">Creating The Node</a></li>
<li><a href="#creating-containers_1">Creating Containers</a></li>
<li><a href="#ldap-replication">LDAP Replication</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="cluster-management">Cluster Management<a class="headerlink" href="#cluster-management" title="Permanent link">#</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p>A <a href="../../../reference/api/cluster/">Cluster</a> is a set of containers deployed in one or more <a href="../../../reference/api/node/">Node</a>.
The cluster contains information shared across node, like hostname.</p>
<p>To manage cluster, we can use Cluster Web UI or using API directly.
Note, this page only covers how to manage cluster by using the API directly via <code>curl</code> command.
To use Web UI, refer to <a href="../../webui">Web Interface</a> page for details.</p>
<h2 id="creating-cluster">Creating Cluster<a class="headerlink" href="#creating-cluster" title="Permanent link">#</a></h2>
<p>The following command creates a cluster using <code>curl</code>.</p>
<pre><code>curl http://localhost:8080/clusters \
    -d name=cluster1 \
    -d org_name=my-org \
    -d org_short_name=my-org \
    -d city=Austin \
    -d state=TX \
    -d country_code=US \
    -d admin_email='info@example.com' \
    -d ox_cluster_hostname=gluu.example.com \
    -d admin_pw=secret \
    -X POST -i
</code></pre>

<p>The parameters of the command are explained below:</p>
<ul>
<li><code>name</code> represents the cluster name or label with which the cluster is identified.</li>
<li><code>org_name</code>, <code>org_short_name</code>, <code>city</code>, <code>state</code>, <code>country_code</code>, and <code>admin_email</code> are used for X509 certificate.</li>
<li><code>ox_cluster_hostname</code> is a URL for the appliance; this name must be a resolvable domain name.</li>
<li><code>admin_pw</code> is used for LDAP password, LDAP replication password, and oxTrust admin password.</li>
</ul>
<p>A successful request returns a HTTP 201 status code:</p>
<pre><code>HTTP/1.0 201 CREATED
Content-Type: application/json
Location: http://localhost:8080/clusters/1279de28-b6d0-4052-bd0c-cc46a6fd5f9f

{
    &quot;inum_org&quot;: &quot;@!FDF8.652A.6EFF.F5A3!0001!DA7B.9EB2&quot;,
    &quot;oxauth_containers&quot;: [],
    &quot;inum_appliance&quot;: &quot;@!FDF8.652A.6EFF.F5A3!0002!FA83.4368&quot;,
    &quot;admin_email&quot;: &quot;info@example.com&quot;,
    &quot;inum_appliance_fn&quot;: &quot;FDF8652A6EFFF5A30002FA834368&quot;,
    &quot;description&quot;: null,
    &quot;city&quot;: &quot;Austin&quot;,
    &quot;base_inum&quot;: &quot;@!FDF8.652A.6EFF.F5A3&quot;,
    &quot;inum_org_fn&quot;: &quot;FDF8652A6EFFF5A30001DA7B9EB2&quot;,
    &quot;ldaps_port&quot;: &quot;1636&quot;,
    &quot;ox_cluster_hostname&quot;: &quot;gluu.example.com&quot;,
    &quot;state&quot;: &quot;TX&quot;,
    &quot;country_code&quot;: &quot;US&quot;,
    &quot;ldap_containers&quot;: [],
    &quot;nginx_containers&quot;: [],
    &quot;org_short_name&quot;: &quot;my-org&quot;,
    &quot;org_name&quot;: &quot;my-org&quot;,
    &quot;id&quot;: &quot;0085d134-c60a-483f-8e14-ebf7afd362f0&quot;,
    &quot;oxtrust_containers&quot;: [],
    &quot;name&quot;: &quot;cluster1&quot;,
    &quot;oxidp_containers&quot;: []
}
</code></pre>

<p>A full reference to Cluster API is available at <a href="../../../reference/api/cluster">Cluster API page</a>.</p>
<h2 id="creating-provider">Creating Provider<a class="headerlink" href="#creating-provider" title="Permanent link">#</a></h2>
<p>Provider represents a service that host the nodes. There are various provider type (driver) supported by Gluu Cluster Docker Edition at the moment:</p>
<ol>
<li><code>digitalocean</code></li>
<li><code>aws</code></li>
<li><code>generic</code></li>
</ol>
<p>Note, we will use <code>digitalocean</code> as provider throughout this page.</p>
<p>The following command creates a provider using <code>curl</code>.</p>
<pre><code>curl http://localhost:8080/providers/digitalocean \
    -d name=my_do_provider \
    -d digitalocean_access_token=random-do-token \
    -d digitalocean_region=nyc3 \
    -X POST -i
</code></pre>

<p>A successful request returns a HTTP 201 status code:</p>
<pre><code class="http">HTTP/1.0 201 CREATED
Content-Type: application/json
Location: http://localhost:8080/providers/4362b1a2-ce6a-4b06-9a97-6ba9a0b952ea

{
    &quot;digitalocean_access_token&quot;: &quot;random-do-token&quot;,
    &quot;digitalocean_backups&quot;: false,
    &quot;digitalocean_image&quot;: &quot;ubuntu-14-04-x64&quot;,
    &quot;digitalocean_ipv6&quot;: false,
    &quot;digitalocean_private_networking&quot;: false,
    &quot;digitalocean_region&quot;: &quot;nyc3&quot;,
    &quot;digitalocean_size&quot;: &quot;4gb&quot;,
    &quot;driver&quot;: &quot;digitalocean&quot;,
    &quot;id&quot;: &quot;4362b1a2-ce6a-4b06-9a97-6ba9a0b952ea&quot;,
    &quot;name&quot;: &quot;my_do_provider&quot;
}
</code></pre>

<p>We will need the <code>provider_id</code> when creating nodes, so let's keep the reference to <code>provider_id</code> as environment variable.</p>
<pre><code>export PROVIDER_ID=4362b1a2-ce6a-4b06-9a97-6ba9a0b952ea
</code></pre>

<p>A full reference to Provider API is available at <a href="../../../reference/api/provider">Provider API page</a>.</p>
<h2 id="creating-nodes-and-containers">Creating Nodes and Containers<a class="headerlink" href="#creating-nodes-and-containers" title="Permanent link">#</a></h2>
<p>Once we have one or more providers, we can create node. Node represents the actual server to host containers.
There are 3 node types supported by Gluu Cluster Docker Edition at the moment:</p>
<ol>
<li>Discovery</li>
<li>Master</li>
<li>Worker (optional)</li>
</ol>
<p>A full reference to Node API is available at <a href="../../../reference/api/node">Node API page</a>.</p>
<h3 id="creating-discovery-node">Creating Discovery Node<a class="headerlink" href="#creating-discovery-node" title="Permanent link">#</a></h3>
<p>Discovery node provides service discovery for all containers in the cluster. This node only hosts a single <code>consul</code> container, which is automatically created by the API.</p>
<h4 id="creating-the-node">Creating The Node<a class="headerlink" href="#creating-the-node" title="Permanent link">#</a></h4>
<p>The following command creates a discovery node using <code>curl</code>.</p>
<pre><code>curl http://localhost:8080/nodes/discovery \
    -d name=gluu.discovery \
    -d provider_id=$PROVIDER_ID \
    -X POST -i
</code></pre>

<p>Note, for <code>name</code> parameter, we enforce <code>gluu.discovery</code> as its value. Changing the name will ended up in rejected request.</p>
<p>A successful request returns a HTTP 201 status code:</p>
<pre><code class="http">HTTP/1.0 201 CREATED
Content-Type: application/json
Location: http://localhost:8080/nodes/gluu.discovery

{
    &quot;id&quot;: &quot;1cd58004-4c87-449a-a918-195ff5af2e15&quot;,
    &quot;name&quot;: &quot;gluu.discovery&quot;,
    &quot;provider_id&quot;: &quot;4362b1a2-ce6a-4b06-9a97-6ba9a0b952ea&quot;,
    &quot;type&quot;: &quot;discovery&quot;
}
</code></pre>

<p>Creating a node will take a while, hence the process is running as background job. To check the status, we can make request to the URL as shown in <code>Location</code> header above.</p>
<h3 id="creating-master-node-and-containers">Creating Master Node and Containers<a class="headerlink" href="#creating-master-node-and-containers" title="Permanent link">#</a></h3>
<p>Master node provides <a href="https://docs.docker.com/swarm/overview/">Docker Swarm</a> manager to manage all containers in the cluster.</p>
<h4 id="creating-the-node_1">Creating The Node<a class="headerlink" href="#creating-the-node_1" title="Permanent link">#</a></h4>
<p>The following command creates a master node using <code>curl</code>.</p>
<pre><code>curl http://localhost:8080/nodes/master \
    -d name=gluu-master \
    -d provider_id=$PROVIDER_ID \
    -X POST -i
</code></pre>

<p>A successful request returns a HTTP 201 status code:</p>
<pre><code class="http">HTTP/1.0 201 CREATED
Content-Type: application/json
Location: http://localhost:8080/nodes/gluu-master

{
    &quot;id&quot;: &quot;0c715335-a1fe-4cd8-93f3-73fda8539f88&quot;,
    &quot;name&quot;: &quot;gluu-master&quot;,
    &quot;provider_id&quot;: &quot;4362b1a2-ce6a-4b06-9a97-6ba9a0b952ea&quot;,
    &quot;type&quot;: &quot;master&quot;
}
</code></pre>

<p>Creating a node will take a while, hence the process is running as background job. To check the status, we can make request to the URL as shown in <code>Location</code> header above.</p>
<p>We will need the <code>node_id</code> when creating nodes, so let's keep the reference to <code>node_id</code> as environment variable.</p>
<pre><code>export MASTER_NODE_ID=0c715335-a1fe-4cd8-93f3-73fda8539f88
</code></pre>

<h4 id="ssl-certificate-and-key">SSL Certificate and Key<a class="headerlink" href="#ssl-certificate-and-key" title="Permanent link">#</a></h4>
<p>By default, <code>gluuengine</code> will generate a self-signed SSL certificate and key called <code>nginx.crt</code> and <code>nginx.key</code> under <code>/var/lib/gluuengine/ssl_certs</code> directory.
One can use their own SSL certificate and key.
Simply put their SSL certificate as <code>/var/lib/gluuengine/ssl_certs/nginx.crt</code> and SSL key as <code>/var/lib/gluuengine/ssl_certs/nginx.key</code>.
When those files are exist, <code>gluuengine</code> will not generate self-signed certificate and key.</p>
<h4 id="custom-ldap-schema">Custom LDAP Schema<a class="headerlink" href="#custom-ldap-schema" title="Permanent link">#</a></h4>
<p>Any <code>ldap</code> container has support for custom schema. To deploy custom schema, put the desired schema in <code>.ldif</code> file
on the same machine running <code>gluu-engine</code> under <code>/var/lib/gluuengine/custom/opendj/schema/</code>.
For example, we can create <code>/var/lib/gluuengine/custom/opendj/schema/102-customSchema.ldif</code> for our custom schema.
This file will be added to ldap container located at <code>/opt/opendj/config/schema/102-customSchema.ldif</code>.
The schema is copied on ldap server creation.</p>
<p>Please note, custom schema file must be created first before creating any LDAP container.</p>
<h4 id="custom-oxauth-files">Custom oxAuth Files<a class="headerlink" href="#custom-oxauth-files" title="Permanent link">#</a></h4>
<p>Any <code>oxauth</code> container has support for custom <code>xhtml</code>, <code>xml</code>, or even <code>jar</code> files.
There are predefined directories (create them if not exist yet) to put this file into:</p>
<ol>
<li><code>/var/lib/gluuengine/override/oxauth/pages</code> for any HTML or XML file.</li>
<li><code>/var/lib/gluuengine/override/oxauth/libs</code> for any JAR file.</li>
<li><code>/var/lib/gluuengine/override/oxauth/resources</code> for any resource file (e.g. CSS).</li>
</ol>
<p>Custom oxAuth file can be created before or after <code>oxauth</code> container creation.</p>
<h4 id="custom-oxtrust-files">Custom oxTrust Files<a class="headerlink" href="#custom-oxtrust-files" title="Permanent link">#</a></h4>
<p>Any <code>oxtrust</code> container has support for custom <code>xhtml</code>, <code>xml</code>, or even <code>jar</code> files.
There are predefined directories (create them if not exist yet) to put this file into:</p>
<ol>
<li><code>/var/lib/gluuengine/override/oxtrust/pages</code> for any HTML or XML file.</li>
<li><code>/var/lib/gluuengine/override/oxtrust/libs</code> for any JAR file.</li>
<li><code>/var/lib/gluuengine/override/oxtrust/resources</code> for any resource file (e.g. CSS).</li>
</ol>
<p>Custom oxTrust file can be created before or after <code>oxtrust</code> container creation.</p>
<h4 id="creating-containers">Creating Containers<a class="headerlink" href="#creating-containers" title="Permanent link">#</a></h4>
<p>Once we have a running <code>master</code> node, we can start creating containers. To ensure the cluster running as expected, the order of container creation is shown below:</p>
<ol>
<li><code>ldap</code></li>
<li><code>oxauth</code></li>
<li><code>oxtrust</code></li>
<li><code>nginx</code></li>
</ol>
<p>In this example, we are going to create <code>ldap</code> container using <code>curl</code>:</p>
<pre><code>curl http://localhost:8080/containers/ldap \
    -d node_id=$MASTER_NODE_ID \
    -X POST -i
</code></pre>

<p>A successful request returns a HTTP 202 status code:</p>
<pre><code class="http">HTTP/1.0 202 ACCEPTED
Content-Type: application/json
Location: http://localhost:8080/containers/gluuopendj_dbaadb89-4703-47e2-9d07-5fa7aa76e616
X-Container-Setup-Log: http://localhost:8080/container_logs/gluuopendj_dbaadb89-4703-47e2-9d07-5fa7aa76e616/setup

{
    &quot;cid&quot;: &quot;&quot;,
    &quot;cluster_id&quot;: &quot;0085d134-c60a-483f-8e14-ebf7afd362f0&quot;,
    &quot;hostname&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;c14bd694-3895-4a77-8f51-200a232d5379&quot;,
    &quot;ldap_admin_port&quot;: &quot;4444&quot;,
    &quot;ldap_binddn&quot;: &quot;cn=directory manager&quot;,
    &quot;ldap_jmx_port&quot;: &quot;1689&quot;,
    &quot;ldap_port&quot;: &quot;1389&quot;,
    &quot;ldaps_port&quot;: &quot;1636&quot;,
    &quot;name&quot;: &quot;gluuopendj_dbaadb89-4703-47e2-9d07-5fa7aa76e616&quot;,
    &quot;node_id&quot;: &quot;0c715335-a1fe-4cd8-93f3-73fda8539f88&quot;,
    &quot;state&quot;: &quot;IN_PROGRESS&quot;,
    &quot;type&quot;: &quot;ldap&quot;
}
</code></pre>

<p>Creating a container will take a while, hence the process is running as background job.
To check the status, we can make request to the URL as shown in <code>Location</code> or <code>X-Container-Setup-Log</code> header above.</p>
<p>The rest of the containers can be created by using similar <code>curl</code> command above. Make sure to change the URL.
For example, instead of sending request to <code>http://localhost:8080/containers/ldap</code>,
we need to use <code>http://localhost:8080/containers/oxauth</code> and so on.</p>
<p>A full reference to Container API is available at <a href="../../../reference/api/container">Container API page</a>.</p>
<h4 id="accessing-oxtrust-web-interface">Accessing oxTrust Web Interface<a class="headerlink" href="#accessing-oxtrust-web-interface" title="Permanent link">#</a></h4>
<p>The Gluu Server web interface can be accessed after the deployment of the containers are complete.
The oxTrust UI is run at <code>https://localhost:8443</code> in the master node.
To access the UI, <code>ssh</code> tunneling must be established through <code>docker-machine</code> script that have been installed.</p>
<pre><code>docker-machine ssh gluu-master -L 8443:localhost:8443
</code></pre>

<p>After the tunnel is established, visit <code>https://localhost:8443</code> in the web browser.
The oxTrust login page will load asking for a username and a password.</p>
<ul>
<li>username: <code>admin</code></li>
<li>password: <code>admin_pw</code> value from the cluster object</li>
</ul>
<p>If the credentials are supplied correctly, the page will be redirected to the oxTrust dashboard.</p>
<h3 id="creating-worker-node-and-containers">Creating Worker Node and Containers<a class="headerlink" href="#creating-worker-node-and-containers" title="Permanent link">#</a></h3>
<p>One of the purposes of creating worker node is to achieve HA setup in the cluster.
It means when master node (and its containers) is unavailable, we still have another node (and its containers) to serve requests.
Although creating worker node is an optional step, it's recommended to do so if we want to achieve full-featured Gluu Cluster.</p>
<h4 id="registering-license-key">Registering License Key<a class="headerlink" href="#registering-license-key" title="Permanent link">#</a></h4>
<p>Registering license key is required before registering any worker node.
Refer to <a href="../../overview/#license">License</a> section to see available license types.</p>
<p>To register license key, we need to obtain code, public password, public key, and license password from Gluu.
Afterwards, we can store them as Gluu Cluster's license key.</p>
<p>The following command will create a new license key.</p>
<pre><code class="sh">curl http://localhost:8080/license_keys \
    -d public_key=unique-public-key \
    -d public_password=unique-public-password \
    -d license_password=unique-license-password \
    -d name=testing \
    -d code=unique-code \
    -X POST -i
</code></pre>

<p>Here's an example of the response from request above:</p>
<pre><code class="json">{
        &quot;code&quot;: &quot;unique-code&quot;,
        &quot;id&quot;: &quot;cebc74fe-d4f2-4f02-9e99-4187f6b55b93&quot;,
        &quot;license_password&quot;: &quot;unique-license-password&quot;,
        &quot;metadata&quot;: {
            &quot;expiration_date&quot;: null,
            &quot;license_count_limit&quot;: 100,
            &quot;license_features&quot;: [
                &quot;gluu_server&quot;
            ],
            &quot;license_name&quot;: &quot;testing&quot;,
            &quot;license_type&quot;: null,
            &quot;multi_server&quot;: false,
            &quot;thread_count&quot;: 3
        },
        &quot;name&quot;: &quot;testing&quot;,
        &quot;public_key&quot;: &quot;unique-public-key&quot;
        &quot;public_password&quot;: &quot;unique-public-password&quot;,
        &quot;valid&quot;: true
    }

</code></pre>

<p>Note, <code>public_key</code>, <code>public_password</code>, and <code>license_password</code> must use one-liner values.</p>
<h4 id="creating-the-node_2">Creating The Node<a class="headerlink" href="#creating-the-node_2" title="Permanent link">#</a></h4>
<p>The following command creates a worker node using <code>curl</code>.</p>
<pre><code>curl http://localhost:8080/nodes/worker \
    -d name=gluu-worker \
    -d provider_id=$PROVIDER_ID \
    -X POST -i
</code></pre>

<p>A successful request returns a HTTP 201 status code:</p>
<pre><code class="http">HTTP/1.0 201 CREATED
Content-Type: application/json
Location: http://localhost:8080/nodes/gluu-master

{
    &quot;id&quot;: &quot;0c715335-a1fe-4cd8-93f3-73fda8539f99&quot;,
    &quot;name&quot;: &quot;gluu-worker&quot;,
    &quot;provider_id&quot;: &quot;4362b1a2-ce6a-4b06-9a97-6ba9a0b952ea&quot;,
    &quot;type&quot;: &quot;worker&quot;
}
</code></pre>

<p>Creating a node will take a while, hence the process is running as background job. To check the status, we can make request to the URL as shown in <code>Location</code> header above.</p>
<p>We will need the <code>node_id</code> when creating nodes, so let's keep the reference to <code>node_id</code> as environment variable.</p>
<pre><code>export WORKER_NODE_ID=0c715335-a1fe-4cd8-93f3-73fda8539f99
</code></pre>

<h4 id="creating-containers_1">Creating Containers<a class="headerlink" href="#creating-containers_1" title="Permanent link">#</a></h4>
<p>Once we have a running <code>worker</code> node, we can start creating containers. To ensure the cluster running as expected, the order of container creation is shown below:</p>
<ol>
<li><code>ldap</code></li>
<li><code>oxauth</code></li>
<li><code>nginx</code></li>
</ol>
<p>In this example, we are going to create <code>ldap</code> container using <code>curl</code>:</p>
<pre><code>curl http://localhost:8080/containers/ldap \
    -d node_id=$WORKER_NODE_ID \
    -X POST -i
</code></pre>

<p>A successful request returns a HTTP 202 status code:</p>
<pre><code class="http">HTTP/1.0 202 ACCEPTED
Content-Type: application/json
Location: http://localhost:8080/containers/gluuopendj_dbaadb89-4703-47e2-9d07-5fa7aa76e617
X-Container-Setup-Log: http://localhost:8080/container_logs/gluuopendj_dbaadb89-4703-47e2-9d07-5fa7aa76e617/setup

{
    &quot;cid&quot;: &quot;&quot;,
    &quot;cluster_id&quot;: &quot;0085d134-c60a-483f-8e14-ebf7afd362f0&quot;,
    &quot;hostname&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;c14bd694-3895-4a77-8f51-200a232d5380&quot;,
    &quot;ldap_admin_port&quot;: &quot;4444&quot;,
    &quot;ldap_binddn&quot;: &quot;cn=directory manager&quot;,
    &quot;ldap_jmx_port&quot;: &quot;1689&quot;,
    &quot;ldap_port&quot;: &quot;1389&quot;,
    &quot;ldaps_port&quot;: &quot;1636&quot;,
    &quot;name&quot;: &quot;gluuopendj_dbaadb89-4703-47e2-9d07-5fa7aa76e617&quot;,
    &quot;node_id&quot;: &quot;0c715335-a1fe-4cd8-93f3-73fda8539f99&quot;,
    &quot;state&quot;: &quot;IN_PROGRESS&quot;,
    &quot;type&quot;: &quot;ldap&quot;
}
</code></pre>

<p>Creating a container will take a while, hence the process is running as background job.
To check the status, we can make request to the URL as shown in <code>Location</code> or <code>X-Container-Setup-Log</code> header above.</p>
<p>The rest of the containers can be created by using similar <code>curl</code> command above. Make sure to change the URL.
For example, instead of sending request to <code>http://localhost:8080/containers/ldap</code>,
we need to use <code>http://localhost:8080/containers/oxauth</code> and so on.</p>
<h4 id="ldap-replication">LDAP Replication<a class="headerlink" href="#ldap-replication" title="Permanent link">#</a></h4>
<p>As we have two LDAP containers in the cluster (one each in master and worker node), all these LDAP containers will replicate themselves.
However we need to check whether replication are created successfully by login to one of the LDAP containers.</p>
<p>We can list all containers in the cluster by running the following command:</p>
<pre><code>docker `docker-machine config --swarm gluu-master` ps
</code></pre>

<p>Here's an example of the output:</p>
<pre><code>CONTAINER ID        IMAGE                               NAMES
f7f150462622        registry.gluu.org:5000/gluuopendj   gluu-worker/gluuopendj_e7c3ce2c-3d0f-40a1-bdd2-c4bfbabb6b16
41ccbfdbd124        registry.gluu.org:5000/gluuopendj   gluu-master/gluuopendj_094ca34d-bd4b-4112-96f0-140b9652f20f
</code></pre>

<p>From the example above, we know that one of the LDAP containers is having <code>41ccbfdbd124</code> as its ID. We can login to this container by running this command:</p>
<pre><code>docker `docker-machine config --swarm gluu-master` exec -ti 41ccbfdbd124 bash
</code></pre>
<p>Once we are logged into the container, we can check the replication status by running the following command:</p>
<pre><code>/opt/opendj/bin/dsreplication status
</code></pre>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../getting-started/" title="Getting Started" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </span>
            </div>
          </a>
        
        
          <a href="../components/" title="Components" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Components
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017, Gluu, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-2afe21e0b2.js"></script>
      <script>var config={url:{base:"../.."}},app=new Application(config);app.initialize()</script>
      
    
    
      
    
  </body>
</html>